@model IEnumerable<BIIC_Contest.Models.tbl_submission>

@{
    ViewBag.Title = "Danh sách bài dự thi";
    Layout = "~/Views/Shared/_LayoutExaminer.cshtml";

    var fields = ViewBag.Fields as List<string> ?? new List<string>();
    // Chuyển đổi trạng thái sang string để so sánh dễ hơn
    var statuses = ViewBag.Statuses as List<string> ?? new List<string>();

    int currentPage = ViewBag.CurrentPage ?? 1;
    int totalPages = ViewBag.TotalPages ?? 1;
    string selectedField = ViewBag.SelectedField;
    string selectedStatus = ViewBag.SelectedStatus;
}

@section styles {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
}

<div class="pb-5">
    <div class="row gx-6 gy-3 mb-4 align-items-center">
        <div class="col-auto">
            <h2 class="mb-0">
                Danh sách bài dự thi
                <span class="fw-normal text-body-tertiary ms-3">(@ViewBag.TotalRecords)</span>
            </h2>
        </div>
        @* --- XÓA BỎ NÚT "THÊM BÀI DỰ THI" VÌ EXAMINER KHÔNG CÓ QUYỀN NÀY --- *@
    </div>

    <div class="row justify-content-between align-items-end mb-4 g-3">
        <div class="col-12 col-sm-auto">
            <form class="d-flex flex-wrap gap-2" method="get" action="@Url.Action("Assignments", "Examiner")">
                <select name="field" class="form-select">
                    <option value="">-- Lĩnh vực --</option>
                    @foreach (var f in fields)
                    {
                        <option value="@f" @(selectedField == f ? "selected" : "")>@f</option>
                    }
                </select>

                <select name="status" class="form-select">
                    <option value="">-- Trạng thái --</option>
                    <option value="Đã tiếp nhận" @(selectedStatus == "Đã tiếp nhận" ? "selected" : "")>Đã tiếp nhận</option>
                    <option value="Đang đánh giá" @(selectedStatus == "Đang đánh giá" ? "selected" : "")>Đang đánh giá</option>
                    <option value="Đã đánh giá" @(selectedStatus == "Đã đánh giá" ? "selected" : "")>Đã đánh giá</option>
                    <option value="Kết quả" @(selectedStatus == "Kết quả" ? "selected" : "")>Kết quả</option>
                    <option value="Đã hủy" @(selectedStatus == "Đã hủy" ? "selected" : "")>Đã hủy</option>
                </select>

                <button type="submit" class="btn btn-outline-primary">
                    <i class="fa fa-filter me-1"></i> Lọc
                </button>
            </form>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
        @foreach (var item in Model)
        {
            string badgeClass;
            switch (item.status)
            {
                //case "Đang đánh giá": badgeClass = "badge bg-warning-subtle text-warning"; break;
                //case "Đã đánh giá": badgeClass = "badge bg-success-subtle text-success"; break;
                //case "Kết quả": badgeClass = "badge bg-primary-subtle text-primary"; break;
                //case "Đã hủy": badgeClass = "badge bg-secondary"; break;
                //default: badgeClass = "badge bg-info-subtle text-info"; break; // Đã tiếp nhận
            }

            <div class="col">
                <div class="card h-100 shadow-sm border-0">
                    <div class="card-body position-relative">
                        <h5 class="card-title">@item.fullname</h5>
                        @*<span class="@badgeClass">@item.status</span>*@
                        <p class="mt-3 text-muted">Lĩnh vực: <strong>@item.field</strong></p>
                        <p class="text-muted">Mã hồ sơ: <code>@item.submission_code</code></p>
                        <p class="text-muted text-truncate" title="@item.description">
                            Mô tả: @item.description
                        </p>
                        <div class="mt-3 d-flex gap-2">
                            @* --- SỬA LẠI ĐƯỜNG DẪN TRỎ ĐẾN ACTION "DETAILS" CỦA "EXAMINERCONTROLLER" --- *@
                            <a href="@Url.Action("Details", "Examiner", new { id = item.submission_id })" class="btn btn-sm btn-primary">
                                <i class="fa fa-eye me-1"></i> Xem & Chấm bài
                            </a>

                            @* --- XÓA TOÀN BỘ NÚT VÀ FORM XÓA --- *@
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="mt-5 text-center">
        <nav>
            <ul class="pagination justify-content-center">
                @for (int i = 1; i <= totalPages; i++)
                {
                    if (i == currentPage)
                    {
                        <li class="page-item active">
                            <span class="page-link">@i</span>
                        </li>
                    }
                    else
                    {
                        <li class="page-item">
                            @* --- SỬA LẠI ĐƯỜNG DẪN TRỎ ĐẾN ACTION "ASSIGNMENTS" CỦA "EXAMINERCONTROLLER" --- *@
                            <a class="page-link" href="@Url.Action("Assignments", "Examiner", new { page = i, field = selectedField, status = selectedStatus })">@i</a>
                        </li>
                    }
                }
            </ul>
        </nav>
    </div>
</div>