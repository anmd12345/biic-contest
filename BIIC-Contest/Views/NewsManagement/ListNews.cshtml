
@{
    ViewBag.Title = "ListNews";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}


<div class="row">
    <div class="col-12">
        <div class="mx-n4 px-4 mx-lg-n6 px-lg-6 bg-body-emphasis">
            <div id="projectSummary" data-list='{"valueNames":["project","assignees","start","deadline","calculation","projectprogress","status","action"],"page":6,"pagination":true}'>
                <div class="row align-items-end justify-content-between pb-4 g-3">
                    <div class="col-auto">
                        <h3>Danh sách bài viết</h3>
                        <p class="text-body-tertiary lh-sm mb-0">Tóm tắt tất cả bài viết</p>
                    </div>
                </div>
                <div class="table-responsive ms-n1 ps-1 scrollbar">
                    <table class="table fs-9 mb-0 border-top border-translucent">
                        <thead>
                            <tr>
                                <th style="width: 25%;">Tiêu đề</th>
                                <th>Ngày tạo</th>
                                <th>Trạng thái</th>
                                <th>Lượt xem</th>
                                <th>Thích</th>
                                <th>Chia sẻ</th>
                                <th>Đang ưu tiên</th>
                                <th class="text-end">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody class="list" id="project-summary-table-body">
                            <!-- Dữ liệu sẽ được render bằng JavaScript -->
                        </tbody>
                    </table>
                </div>

                <div class="row align-items-center justify-content-between py-2 pe-0 fs-9">
                    <div class="col-auto d-flex">
                        <p class="mb-0 me-3 fw-semibold text-body" id="paging-info"></p>
                    </div>
                    <div class="col-auto d-flex">
                        <button class="page-link" id="prev-page"><span class="fas fa-chevron-left"></span></button>
                        <ul class="mb-0 pagination px-2" id="page-buttons"></ul>
                        <button class="page-link" id="next-page"><span class="fas fa-chevron-right"></span></button>
                    </div>
                </div>

            
            </div>
        </div>
    </div>
</div>


@section Scripts {

    <script>
        function formatDate(input) {
            const date = new Date(input);
            return date.toLocaleDateString("vi-VN");
        }

        function renderStatus(status) {
            switch (status) {
                case 0: return '<span class="badge bg-secondary">Ẩn</span>';
                case 1: return '<span class="badge bg-success">Hiển thị</span>';
                case 2: return '<span class="badge bg-warning text-dark">Lưu nháp</span>';
                default: return '<span class="badge bg-dark">Không rõ</span>';
            }
        }

        let currentPage = 1;
        let pageSize = 5;
        let totalRecords = 0;

        function loadNews(page, size) {
            fetch(`/apis/v1/news/list?page=${page}&pageSize=${size}`)
                .then(response => response.json())
                .then(result => {
                    if (!result.Success) {
                        alert(result.Message);
                        return;
                    }

                    currentPage = page;
                    totalRecords = result.TotalRecords;

                    const tbody = document.getElementById("project-summary-table-body");
                    tbody.innerHTML = "";

                    result.Data.forEach((item) => {
                        const row = document.createElement("tr");
                        row.classList.add("position-static");

                        row.innerHTML = `
                                <td class="align-middle project text-truncate" style="max-width: 250px;">
                                    <a class="fw-bold fs-8 text-decoration-none d-inline-block"
                                       title="${item.title}">
                                       ${item.title}
                                    </a>
                                </td>
                                <td class="align-middle start">
                                    <p class="mb-0 fs-9 text-body">${item.created_at}</p>
                                </td>
                                <td class="align-middle deadline">${renderStatus(item.status)}</td>
                                <td class="align-middle"><span class="text-muted">${item.view ?? 0} </span></td>
                                <td class="align-middle"><span class="text-muted">${item.like ?? 0} </span></td>
                                <td class="align-middle"><span class="text-muted">${item.share ?? 0} </span></td>
                                <td class="align-middle">${item.is_priority ? '<span class="text-danger fw-bold">Đang ưu tiên</span>' : '<span class="text-muted">Không</span>'}</td>
                                <td class="align-middle text-end action pe-0">
                                    <div class="btn-reveal-trigger position-static">
                                        <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal fs-10"
                                                type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="fas fa-ellipsis-h fs-10"></span>
                                        </button>
                                        <div class="dropdown-menu dropdown-menu-end py-2">
                                            <a class="dropdown-item" href="#">Xem</a>
                                            <a class="dropdown-item" href="#">Sửa</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item text-danger" href="#">Xoá</a>
                                        </div>
                                    </div>
                                </td>
                            `;
                        tbody.appendChild(row);
                    });

                    updatePagination();
                });
        }

        function updatePagination() {
            const totalPages = Math.ceil(totalRecords / pageSize);
            const pagingInfo = document.getElementById("paging-info");
            const pageButtons = document.getElementById("page-buttons");

            pagingInfo.textContent = `Trang ${currentPage} / ${totalPages}`;
            pageButtons.innerHTML = "";

            for (let i = 1; i <= totalPages; i++) {
                const li = document.createElement("li");
                li.className = "page-item" + (i === currentPage ? " active" : "");

                const a = document.createElement("a");
                a.className = "page-link";
                a.href = "#";
                a.textContent = i;
                a.addEventListener("click", function (e) {
                    e.preventDefault();
                    loadNews(i, pageSize);
                });

                li.appendChild(a);
                pageButtons.appendChild(li);
            }

            document.getElementById("prev-page").onclick = function () {
                if (currentPage > 1) loadNews(currentPage - 1, pageSize);
            };
            document.getElementById("next-page").onclick = function () {
                if (currentPage < totalPages) loadNews(currentPage + 1, pageSize);
            };
        }

        document.addEventListener("DOMContentLoaded", function () {
            loadNews(1, 5);
        });
    </script>

    @*<script>
        document.addEventListener("DOMContentLoaded", function () {
            loadNews(1, 5); // mặc định page 1, 5 item

            function loadNews(page, pageSize) {
                fetch(`/apis/v1/news/list?page=${page}&pageSize=${pageSize}`)
                    .then(response => response.json())
                    .then(result => {
                        if (!result.Success) {
                            alert(result.Message);
                            return;
                        }

                        const tbody = document.getElementById("project-summary-table-body");
                        tbody.innerHTML = "";

                        result.Data.forEach((item, index) => {
                            const row = document.createElement("tr");
                            row.classList.add("position-static");

                            row.innerHTML = `
                                <td class="align-middle project text-truncate" style="max-width: 250px;">
                                    <a class="fw-bold fs-8 text-decoration-none d-inline-block"
                                       title="${item.title}">
                                       ${item.title}
                                    </a>
                                </td>
                                <td class="align-middle start">
                                    <p class="mb-0 fs-9 text-body">${formatDate(item.created_at)}</p>
                                </td>
                                <td class="align-middle deadline">
                                    ${renderStatus(item.status)}
                                </td>
                                <td class="align-middle"><span class="text-muted">${item.view_count} 👁</span></td>
                                <td class="align-middle"><span class="text-muted">${item.like_count} ❤️</span></td>
                                <td class="align-middle"><span class="text-muted">${item.share_count} 🔁</span></td>
                                <td class="align-middle">${item.is_priority ? '<span class="text-danger fw-bold">🔥</span>' : ''}</td>
                                <td class="align-middle text-end action pe-0">
                                    <div class="btn-reveal-trigger position-static">
                                        <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal fs-10"
                                                type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="fas fa-ellipsis-h fs-10"></span>
                                        </button>
                                        <div class="dropdown-menu dropdown-menu-end py-2">
                                            <a class="dropdown-item" href="#">Xem</a>
                                            <a class="dropdown-item" href="#">Sửa</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item text-danger" href="#">Xoá</a>
                                        </div>
                                    </div>
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                    });
            }

            function formatDate(input) {
                const date = new Date(input);
                return date.toLocaleDateString("vi-VN");
            }

            function renderStatus(status) {
                switch (status) {
                    case 0:
                        return '<span class="badge bg-secondary">Ẩn</span>';
                    case 1:
                        return '<span class="badge bg-success">Hiển thị</span>';
                    case 2:
                        return '<span class="badge bg-warning text-dark">Lưu nháp</span>';
                    default:
                        return '<span class="badge bg-dark">Không rõ</span>';
                }
            }
        });
        </script>*@
}
